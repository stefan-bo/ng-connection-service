!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/common/http"),require("lodash")):"function"==typeof define&&define.amd?define("ng-connection-service",["exports","@angular/core","rxjs","rxjs/operators","@angular/common/http","lodash"],e):e((t=t||self)["ng-connection-service"]={},t.ng.core,t.rxjs,t.rxjs.operators,t.ng.common.http,t.lodash)}(this,function(t,e,n,r,i,o){"use strict";var s=new e.InjectionToken("ConnectionServiceOptionsToken"),c=function(){function t(n,r){this.http=n,this.stateChangeEventEmitter=new e.EventEmitter,this.currentState={hasInternetAccess:!1,hasNetworkConnection:window.navigator.onLine},this.serviceOptions=o.defaults({},r,t.DEFAULT_OPTIONS),this.checkNetworkState(),this.checkInternetState()}return Object.defineProperty(t.prototype,"options",{get:function(){return o.clone(this.serviceOptions)},enumerable:!0,configurable:!0}),t.prototype.checkInternetState=function(){var t=this;o.isNil(this.httpSubscription)||this.httpSubscription.unsubscribe(),this.serviceOptions.enableHeartbeat?this.httpSubscription=n.timer(0,this.serviceOptions.heartbeatInterval).pipe(r.switchMap(function(){return t.http[t.serviceOptions.requestMethod](t.serviceOptions.heartbeatUrl,{responseType:"text"})}),r.retryWhen(function(e){return e.pipe(r.tap(function(e){console.error("Http error:",e),t.currentState.hasInternetAccess=!1,t.emitEvent()}),r.delay(t.serviceOptions.heartbeatRetryInterval))})).subscribe(function(e){t.currentState.hasInternetAccess=!0,t.emitEvent()}):(this.currentState.hasInternetAccess=!1,this.emitEvent())},t.prototype.checkNetworkState=function(){var t=this;this.onlineSubscription=n.fromEvent(window,"online").subscribe(function(){t.currentState.hasNetworkConnection=!0,t.checkInternetState(),t.emitEvent()}),this.offlineSubscription=n.fromEvent(window,"offline").subscribe(function(){t.currentState.hasNetworkConnection=!1,t.checkInternetState(),t.emitEvent()})},t.prototype.emitEvent=function(){this.stateChangeEventEmitter.emit(this.currentState)},t.prototype.ngOnDestroy=function(){try{this.offlineSubscription.unsubscribe(),this.onlineSubscription.unsubscribe(),this.httpSubscription.unsubscribe()}catch(t){}},t.prototype.monitor=function(t){return void 0===t&&(t=!0),t?this.stateChangeEventEmitter.pipe(r.debounceTime(300),r.startWith(this.currentState)):this.stateChangeEventEmitter.pipe(r.debounceTime(300))},t.prototype.updateOptions=function(t){this.serviceOptions=o.defaults({},t,this.serviceOptions),this.checkInternetState()},t.DEFAULT_OPTIONS={enableHeartbeat:!0,heartbeatUrl:"//internethealthtest.org",heartbeatInterval:3e4,heartbeatRetryInterval:1e3,requestMethod:"head"},t.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:i.HttpClient},{type:void 0,decorators:[{type:e.Inject,args:[s]},{type:e.Optional}]}]},t.ngInjectableDef=e.ɵɵdefineInjectable({factory:function(){return new t(e.ɵɵinject(i.HttpClient),e.ɵɵinject(s,8))},token:t,providedIn:"root"}),t}(),a=function(){function t(){}return t.decorators=[{type:e.NgModule,args:[{imports:[i.HttpClientModule],providers:[c]}]}],t}();t.ConnectionService=c,t.ConnectionServiceModule=a,t.ConnectionServiceOptionsToken=s,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ng-connection-service.umd.min.js.map